Version:0.9
StartHTML:0000000105
EndHTML:0000022529
StartFragment:0000000141
EndFragment:0000022493
<html>
<body>
<!--StartFragment--><div style="color: #000000;background-color: #ffffff;font-family: 'CaskaydiaCove Nerd Font', 'Cascadia Code',Consolas, 'Courier New', monospace, Consolas, 'Courier New', monospace;font-weight: normal;font-size: 13.5px;line-height: 18px;white-space: pre;"><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;iostream&gt;</span></div><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;ws2tcpip.h&gt;</span></div><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;WinSock2.h&gt;</span></div><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;windows.h&gt;</span></div><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;stdlib.h&gt;</span></div><div><span style="color: #222222;">#</span><span style="color: #af00db;">include</span><span style="color: #0000ff;"> </span><span style="color: #a31515;">&lt;stdio.h&gt;</span></div><br><div><span style="color: #222222;">#</span><span style="color: #af00db;">pragma</span><span style="color: #0000ff;"> </span><span style="color: #ff0000;">comment</span><span style="color: #0000ff;"> (</span><span style="color: #ff0000;">lib</span><span style="color: #0000ff;">, </span><span style="color: #a31515;">"Ws2_32.lib"</span><span style="color: #0000ff;">)</span></div><br><div><span style="color: #0000ff;">int</span><span style="color: #000000;"> </span><span style="color: #795e26;">main</span><span style="color: #222222;">(</span><span style="color: #0000ff;">void</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; WSADATA wsadata</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> </span><span style="color: #267f99;">addrinfo</span><span style="color: #0000ff;">*</span><span style="color: #000000;"> </span><span style="color: #001080;">result</span><span style="color: #000000;"> = </span><span style="color: #0000ff;">NULL</span><span style="color: #222222;">,</span><span style="color: #000000;"> hints</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #0000ff;">auto</span><span style="color: #000000;"> iresult = </span><span style="color: #795e26;">WSAStartup</span><span style="color: #222222;">(</span><span style="color: #795e26;">MAKEWORD</span><span style="color: #222222;">(</span><span style="color: #098658;">2</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #098658;">2</span><span style="color: #222222;">),</span><span style="color: #000000;"> &amp;wsadata</span><span style="color: #222222;">);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #0000ff;">char</span><span style="color: #000000;"> sendbuf[] = </span><span style="color: #a31515;">"P""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\xff</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\xff</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x03</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x14</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x01</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x14</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\xe8</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x03</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\xa8</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x08</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\x00</span><span style="color: #a31515;">""</span><span style="color: #ff0000;">\xe4</span><span style="color: #a31515;">""j""</span><span style="color: #ff0000;">\xbe</span><span style="color: #a31515;">""&lt;""</span><span style="color: #ff0000;">\x1d</span><span style="color: #a31515;">""O""</span><span style="color: #ff0000;">\xa1</span><span style="color: #a31515;">""C"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #0000ff;">char</span><span style="color: #000000;"> </span><span style="color: #001080;">recvbuf</span><span style="color: #222222;">[</span><span style="color: #098658;">512</span><span style="color: #222222;">];</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> recvbuflen = </span><span style="color: #098658;">512</span><span style="color: #222222;">;</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">iresult != </span><span style="color: #098658;">0</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"WSAStartup failed with error: "</span><span style="color: #000000;"> &lt;&lt; iresult &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><br><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #795e26;">ZeroMemory</span><span style="color: #222222;">(</span><span style="color: #000000;">&amp;hints</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #0000ff;">sizeof</span><span style="color: #222222;">(</span><span style="color: #000000;">hints</span><span style="color: #222222;">));</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #001080;">hints</span><span style="color: #222222;">.ai_family</span><span style="color: #000000;"> = AF_UNSPEC</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #001080;">hints</span><span style="color: #222222;">.ai_socktype</span><span style="color: #000000;"> = SOCK_STREAM</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #001080;">hints</span><span style="color: #222222;">.ai_protocol</span><span style="color: #000000;"> = IPPROTO_TCP</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; iresult = </span><span style="color: #795e26;">getaddrinfo</span><span style="color: #222222;">(</span><span style="color: #a31515;">"127.0.0.1"</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #a31515;">"45237"</span><span style="color: #222222;">,</span><span style="color: #000000;"> &amp;hints</span><span style="color: #222222;">,</span><span style="color: #000000;"> &amp;result</span><span style="color: #222222;">);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">iresult != </span><span style="color: #098658;">0</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"getaddrinfo failed: "</span><span style="color: #000000;"> &lt;&lt; iresult &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><br><div><span style="color: #000000;">&#160; &#160; SOCKET tcp_socket = </span><span style="color: #795e26;">socket</span><span style="color: #222222;">(</span><span style="color: #001080;">result</span><span style="color: #222222;">-&gt;ai_family,</span><span style="color: #000000;"> </span><span style="color: #001080;">result</span><span style="color: #222222;">-&gt;ai_socktype,</span><span style="color: #000000;"> </span><span style="color: #001080;">result</span><span style="color: #222222;">-&gt;ai_protocol);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #795e26;">WSAGetLastError</span><span style="color: #222222;">()</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">tcp_socket == INVALID_SOCKET</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Error at socket(): "</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #795e26;">WSAGetLastError</span><span style="color: #222222;">()</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><br><div><span style="color: #000000;">&#160; &#160; iresult = </span><span style="color: #795e26;">connect</span><span style="color: #222222;">(</span><span style="color: #000000;">tcp_socket</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #001080;">result</span><span style="color: #222222;">-&gt;ai_addr,</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #0000ff;">int</span><span style="color: #222222;">)</span><span style="color: #001080;">result</span><span style="color: #222222;">-&gt;ai_addrlen);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">iresult == SOCKET_ERROR</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Error at connect(): "</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #795e26;">WSAGetLastError</span><span style="color: #222222;">()</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #795e26;">freeaddrinfo</span><span style="color: #222222;">(</span><span style="color: #000000;">result</span><span style="color: #222222;">);</span></div><br><div><span style="color: #000000;">&#160; &#160; iresult = </span><span style="color: #795e26;">send</span><span style="color: #222222;">(</span><span style="color: #000000;">tcp_socket</span><span style="color: #222222;">,</span><span style="color: #000000;"> sendbuf</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #098658;">30</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #098658;">0</span><span style="color: #222222;">);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">iresult == SOCKET_ERROR</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Error at send(): "</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #795e26;">WSAGetLastError</span><span style="color: #222222;">()</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Send "</span><span style="color: #000000;"> &lt;&lt; iresult &lt;&lt; </span><span style="color: #a31515;">" bytes</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><br><div><span style="color: #000000;">&#160; &#160; iresult = </span><span style="color: #795e26;">recv</span><span style="color: #222222;">(</span><span style="color: #000000;">tcp_socket</span><span style="color: #222222;">,</span><span style="color: #000000;"> recvbuf</span><span style="color: #222222;">,</span><span style="color: #000000;"> recvbuflen</span><span style="color: #222222;">,</span><span style="color: #000000;"> </span><span style="color: #098658;">0</span><span style="color: #222222;">);</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">if</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #000000;">iresult &lt;= </span><span style="color: #098658;">0</span><span style="color: #222222;">)</span><span style="color: #000000;"> </span><span style="color: #222222;">{</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Error at send(): "</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #795e26;">WSAGetLastError</span><span style="color: #222222;">()</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #a31515;">"</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #af00db;">return</span><span style="color: #000000;"> </span><span style="color: #098658;">1</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #222222;">}</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">"Received "</span><span style="color: #000000;"> &lt;&lt; iresult &lt;&lt; </span><span style="color: #a31515;">" bytes: ("</span><span style="color: #222222;">;</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #af00db;">for</span><span style="color: #000000;"> </span><span style="color: #222222;">(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i = </span><span style="color: #098658;">0</span><span style="color: #222222;">;</span><span style="color: #000000;"> i &lt; iresult</span><span style="color: #222222;">;</span><span style="color: #000000;"> i++</span><span style="color: #222222;">)</span></div><div><span style="color: #000000;">&#160; &#160; &#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">hex &lt;&lt; </span><span style="color: #222222;">(</span><span style="color: #0000ff;">uint8_t</span><span style="color: #222222;">)</span><span style="color: #001080;">recvbuf</span><span style="color: #222222;">[</span><span style="color: #000000;">i</span><span style="color: #222222;">]</span><span style="color: #000000;"> &lt;&lt; </span><span style="color: #222222;">(</span><span style="color: #000000;">i == iresult-</span><span style="color: #098658;">1</span><span style="color: #000000;"> ? </span><span style="color: #a31515;">""</span><span style="color: #000000;"> : </span><span style="color: #a31515;">" "</span><span style="color: #222222;">);</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #267f99;">std</span><span style="color: #222222;">::</span><span style="color: #000000;">cout &lt;&lt; </span><span style="color: #a31515;">")</span><span style="color: #ff0000;">\n</span><span style="color: #a31515;">"</span><span style="color: #222222;">;</span></div><br><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #795e26;">closesocket</span><span style="color: #222222;">(</span><span style="color: #000000;">tcp_socket</span><span style="color: #222222;">);</span></div><div><span style="color: #000000;">&#160; &#160; </span><span style="color: #795e26;">WSACleanup</span><span style="color: #222222;">();</span></div><div><span style="color: #222222;">}</span></div></div><!--EndFragment-->
</body>
</html>